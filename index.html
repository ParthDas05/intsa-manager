<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instagram Page Calendar Manager</title>
    <style>
        /* ========== CSS VARIABLES & RESET ========== */
        :root {
            --primary: #e1306c;
            --primary-light: #f77fbe;
            --secondary: #405de6;
            --accent: #5851db;
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
            --bg: #fafafa;
            --card: #ffffff;
            --text: #262626;
            --text-light: #8e8e8e;
            --border: #dbdbdb;
            --shadow: 0 2px 12px rgba(0,0,0,0.1);
            --radius: 12px;
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* ========== LAYOUT ========== */
        .app-container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 280px;
            background: var(--card);
            border-right: 1px solid var(--border);
            padding: 20px;
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
            transition: var(--transition);
        }

        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 20px;
            min-height: 100vh;
            transition: var(--transition);
        }

        /* ========== SIDEBAR STYLES ========== */
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px 0;
            border-bottom: 1px solid var(--border);
            margin-bottom: 20px;
        }

        .logo-icon {
            font-size: 28px;
        }

        .logo-text {
            font-size: 18px;
            font-weight: 700;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-section {
            margin-bottom: 25px;
        }

        .nav-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }

        .nav-btn {
            width: 100%;
            padding: 12px 15px;
            border: none;
            background: transparent;
            border-radius: var(--radius);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 14px;
            color: var(--text);
            transition: var(--transition);
            text-align: left;
        }

        .nav-btn:hover {
            background: linear-gradient(135deg, rgba(225,48,108,0.1), rgba(64,93,230,0.1));
        }

        .nav-btn.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .nav-btn-icon {
            font-size: 18px;
            width: 24px;
            text-align: center;
        }

        .pages-list {
            flex: 1;
            overflow-y: auto;
        }

        .page-item {
            padding: 12px 15px;
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 8px;
            border: 1px solid transparent;
        }

        .page-item:hover {
            background: rgba(225,48,108,0.05);
            border-color: var(--border);
        }

        .page-item.active {
            background: linear-gradient(135deg, rgba(225,48,108,0.1), rgba(64,93,230,0.1));
            border-color: var(--primary);
        }

        .page-item-name {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .page-item-meta {
            font-size: 12px;
            color: var(--text-light);
        }

        .add-page-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: var(--transition);
            margin-top: 15px;
        }

        .add-page-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .global-export-btn {
            width: 100%;
            padding: 12px;
            background: var(--success);
            color: white;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: var(--transition);
            margin-top: 10px;
        }

        .global-export-btn:hover {
            background: #27ae60;
            transform: translateY(-2px);
        }

        /* ========== CARDS & PANELS ========== */
        .card {
            background: var(--card);
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
        }

        /* ========== DASHBOARD ========== */
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 25px;
            border-radius: var(--radius);
            text-align: center;
        }

        .stat-value {
            font-size: 36px;
            font-weight: 700;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
            margin-top: 5px;
        }

        .welcome-message {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-light);
        }

        .welcome-message h2 {
            font-size: 24px;
            margin-bottom: 10px;
            color: var(--text);
        }

        .welcome-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        /* ========== WORKSPACE ========== */
        .workspace-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
        }

        .back-btn {
            padding: 10px 15px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 16px;
            transition: var(--transition);
        }

        .back-btn:hover {
            background: var(--border);
        }

        .page-name-input {
            font-size: 28px;
            font-weight: 700;
            border: none;
            background: transparent;
            width: 100%;
            padding: 10px 0;
            outline: none;
            border-bottom: 2px solid transparent;
            transition: var(--transition);
        }

        .page-name-input:focus {
            border-bottom-color: var(--primary);
        }

        .page-notes-input {
            width: 100%;
            min-height: 100px;
            padding: 15px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-size: 14px;
            resize: vertical;
            outline: none;
            transition: var(--transition);
            font-family: inherit;
        }

        .page-notes-input:focus {
            border-color: var(--primary);
        }

        .workspace-actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 12px 24px;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
        }

        .action-btn.primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .action-btn.secondary {
            background: var(--bg);
            color: var(--text);
            border: 1px solid var(--border);
        }

        .action-btn.danger {
            background: var(--danger);
            color: white;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        /* ========== CALENDAR ========== */
        .calendar-container {
            background: var(--card);
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
        }

        .calendar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
        }

        .calendar-nav {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .calendar-nav-btn {
            width: 40px;
            height: 40px;
            border: 1px solid var(--border);
            background: white;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            transition: var(--transition);
        }

        .calendar-nav-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .calendar-month-year {
            font-size: 22px;
            font-weight: 700;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }

        .calendar-day-header {
            text-align: center;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-light);
            padding: 10px 0;
            text-transform: uppercase;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
            position: relative;
            min-height: 60px;
        }

        .calendar-day:hover {
            background: rgba(225,48,108,0.1);
        }

        .calendar-day.other-month {
            color: var(--text-light);
            opacity: 0.5;
        }

        .calendar-day.today {
            background: linear-gradient(135deg, rgba(225,48,108,0.15), rgba(64,93,230,0.15));
            font-weight: 700;
        }

        .calendar-day.has-content {
            border-color: var(--primary);
        }

        .calendar-day.has-content::after {
            content: '';
            position: absolute;
            bottom: 6px;
            width: 6px;
            height: 6px;
            background: var(--primary);
            border-radius: 50%;
        }

        .calendar-day.selected {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .calendar-day.selected::after {
            background: white;
        }

        .calendar-day-number {
            font-size: 16px;
            font-weight: 500;
        }

        /* ========== DATE DETAIL PANEL ========== */
        .date-panel {
            position: fixed;
            top: 0;
            right: -500px;
            width: 100%;
            max-width: 480px;
            height: 100vh;
            background: var(--card);
            box-shadow: -5px 0 30px rgba(0,0,0,0.2);
            z-index: 200;
            transition: right 0.4s ease;
            overflow-y: auto;
        }

        .date-panel.open {
            right: 0;
        }

        .date-panel-header {
            position: sticky;
            top: 0;
            background: var(--card);
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 10;
        }

        .date-panel-title {
            font-size: 18px;
            font-weight: 700;
        }

        .close-panel-btn {
            width: 36px;
            height: 36px;
            border: none;
            background: var(--bg);
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            transition: var(--transition);
        }

        .close-panel-btn:hover {
            background: var(--danger);
            color: white;
        }

        .date-panel-content {
            padding: 20px;
        }

        .panel-section {
            margin-bottom: 25px;
        }

        .panel-section-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
        }

        /* ========== IMAGE UPLOAD ========== */
        .image-upload-area {
            border: 2px dashed var(--border);
            border-radius: var(--radius);
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .image-upload-area:hover {
            border-color: var(--primary);
            background: rgba(225,48,108,0.05);
        }

        .image-upload-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .image-upload-text {
            color: var(--text-light);
            font-size: 14px;
        }

        .image-preview-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .image-preview-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: 8px;
            overflow: hidden;
        }

        .image-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-delete-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 24px;
            height: 24px;
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: var(--transition);
        }

        .image-preview-item:hover .image-delete-btn {
            opacity: 1;
        }

        /* ========== FORM ELEMENTS ========== */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text);
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-size: 14px;
            outline: none;
            transition: var(--transition);
            font-family: inherit;
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            border-color: var(--primary);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-select {
            cursor: pointer;
            background: white;
        }

        /* ========== RICH TEXT EDITOR ========== */
        .rich-editor {
            border: 1px solid var(--border);
            border-radius: var(--radius);
            overflow: hidden;
        }

        .rich-editor-toolbar {
            display: flex;
            gap: 5px;
            padding: 10px;
            background: var(--bg);
            border-bottom: 1px solid var(--border);
            flex-wrap: wrap;
        }

        .editor-btn {
            width: 32px;
            height: 32px;
            border: 1px solid var(--border);
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: var(--transition);
        }

        .editor-btn:hover, .editor-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .rich-editor-content {
            min-height: 120px;
            padding: 15px;
            outline: none;
            font-size: 14px;
            line-height: 1.6;
        }

        .rich-editor-content:focus {
            background: rgba(225,48,108,0.02);
        }

        /* ========== STATUS BADGES ========== */
        .status-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .status-option {
            padding: 8px 16px;
            border: 2px solid var(--border);
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: var(--transition);
        }

        .status-option:hover {
            border-color: var(--text-light);
        }

        .status-option.selected {
            border-color: currentColor;
        }

        .status-option[data-value="idea"] { color: var(--secondary); }
        .status-option[data-value="designing"] { color: var(--warning); }
        .status-option[data-value="ready"] { color: var(--success); }
        .status-option[data-value="posted"] { color: var(--primary); }

        .status-option.selected[data-value="idea"] { background: rgba(64,93,230,0.1); }
        .status-option.selected[data-value="designing"] { background: rgba(243,156,18,0.1); }
        .status-option.selected[data-value="ready"] { background: rgba(46,204,113,0.1); }
        .status-option.selected[data-value="posted"] { background: rgba(225,48,108,0.1); }

        /* ========== POST TYPE OPTIONS ========== */
        .type-options {
            display: flex;
            gap: 10px;
        }

        .type-option {
            flex: 1;
            padding: 15px;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            cursor: pointer;
            text-align: center;
            transition: var(--transition);
        }

        .type-option:hover {
            border-color: var(--primary);
        }

        .type-option.selected {
            border-color: var(--primary);
            background: rgba(225,48,108,0.1);
        }

        .type-option-icon {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .type-option-label {
            font-size: 12px;
            font-weight: 600;
        }

        /* ========== TOAST NOTIFICATIONS ========== */
        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            padding: 15px 25px;
            background: var(--card);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideIn 0.3s ease;
            border-left: 4px solid var(--primary);
        }

        .toast.success { border-left-color: var(--success); }
        .toast.error { border-left-color: var(--danger); }
        .toast.warning { border-left-color: var(--warning); }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* ========== MODAL ========== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 300;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .modal-overlay.open {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--card);
            border-radius: var(--radius);
            padding: 30px;
            max-width: 400px;
            width: 90%;
            transform: scale(0.9);
            transition: var(--transition);
        }

        .modal-overlay.open .modal {
            transform: scale(1);
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .modal-text {
            color: var(--text-light);
            margin-bottom: 20px;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        /* ========== MOBILE NAVIGATION ========== */
        .mobile-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: var(--card);
            border-top: 1px solid var(--border);
            padding: 10px;
            z-index: 150;
            justify-content: space-around;
        }

        .mobile-nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px 15px;
            border: none;
            background: transparent;
            cursor: pointer;
            color: var(--text-light);
            font-size: 10px;
            transition: var(--transition);
        }

        .mobile-nav-btn.active {
            color: var(--primary);
        }

        .mobile-nav-btn-icon {
            font-size: 20px;
        }

        .menu-toggle {
            display: none;
            position: fixed;
            top: 15px;
            left: 15px;
            width: 44px;
            height: 44px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            cursor: pointer;
            z-index: 160;
            font-size: 20px;
        }

        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 90;
        }

        /* ========== RESPONSIVE DESIGN ========== */
        @media (max-width: 768px) {
            .sidebar {
                left: -280px;
            }

            .sidebar.open {
                left: 0;
            }

            .sidebar-overlay.open {
                display: block;
            }

            .main-content {
                margin-left: 0;
                padding: 70px 15px 80px;
            }

            .menu-toggle {
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .mobile-nav {
                display: flex;
            }

            .calendar-grid {
                gap: 4px;
            }

            .calendar-day {
                min-height: 45px;
            }

            .calendar-day-number {
                font-size: 14px;
            }

            .date-panel {
                max-width: 100%;
            }

            .image-preview-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .workspace-actions {
                flex-direction: column;
            }

            .action-btn {
                width: 100%;
                justify-content: center;
            }

            .type-options {
                flex-wrap: wrap;
            }

            .type-option {
                flex: 1 1 calc(33% - 10px);
                min-width: 80px;
            }

            .dashboard-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* ========== SCROLLBAR ========== */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-light);
        }

        /* ========== UTILITY CLASSES ========== */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .mt-20 {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <!-- SIDEBAR OVERLAY (Mobile) -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- MENU TOGGLE (Mobile) -->
    <button class="menu-toggle" id="menuToggle">‚ò∞</button>

    <!-- APP CONTAINER -->
    <div class="app-container">
        <!-- SIDEBAR -->
        <aside class="sidebar" id="sidebar">
            <div class="logo">
                <span class="logo-icon">üì∏</span>
                <span class="logo-text">InstaCalendar</span>
            </div>

            <nav class="nav-section">
                <div class="nav-title">Navigation</div>
                <button class="nav-btn active" data-view="dashboard" id="navDashboard">
                    <span class="nav-btn-icon">üè†</span>
                    <span>Dashboard</span>
                </button>
            </nav>

            <div class="nav-section pages-list" id="pagesList">
                <div class="nav-title">Your Pages</div>
                <!-- Pages will be dynamically inserted here -->
            </div>

            <button class="add-page-btn" id="addPageBtn">
                <span>‚ûï</span>
                <span>Add New Page</span>
            </button>

            <button class="global-export-btn" id="globalExportBtn">
                <span>üíæ</span>
                <span>Export All Data</span>
            </button>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="main-content" id="mainContent">
            <!-- Dashboard View -->
            <section id="dashboardView">
                <h1 style="font-size: 28px; margin-bottom: 25px;">üìä Dashboard</h1>
                
                <div class="dashboard-stats" id="dashboardStats">
                    <div class="stat-card">
                        <div class="stat-value" id="totalPages">0</div>
                        <div class="stat-label">Total Pages</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalPosts">0</div>
                        <div class="stat-label">Planned Posts</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalImages">0</div>
                        <div class="stat-label">Images Stored</div>
                    </div>
                </div>

                <div class="card" id="pagesOverview">
                    <div class="card-header">
                        <h2 class="card-title">üì± Your Pages</h2>
                    </div>
                    <div id="pagesGrid">
                        <!-- Pages overview will be inserted here -->
                    </div>
                </div>
            </section>

            <!-- Workspace View -->
            <section id="workspaceView" class="hidden">
                <div class="workspace-header">
                    <button class="back-btn" id="backToDashboard">‚Üê Back</button>
                </div>
                
                <div class="card">
                    <input type="text" class="page-name-input" id="pageNameInput" placeholder="Page Name...">
                    <textarea class="page-notes-input" id="pageNotesInput" placeholder="Add notes about this page..."></textarea>
                    
                    <div class="workspace-actions">
                        <button class="action-btn primary" id="openCalendarBtn">
                            <span>üìÖ</span> Open Calendar
                        </button>
                        <button class="action-btn secondary" id="exportPageBtn">
                            <span>üì§</span> Export This Page
                        </button>
                        <button class="action-btn danger" id="deletePageBtn">
                            <span>üóëÔ∏è</span> Delete Page
                        </button>
                    </div>
                </div>

                <!-- Calendar Container -->
                <div class="calendar-container hidden" id="calendarContainer">
                    <div class="calendar-header">
                        <div class="calendar-nav">
                            <button class="calendar-nav-btn" id="prevMonth">‚Üê</button>
                            <span class="calendar-month-year" id="currentMonthYear">January 2025</span>
                            <button class="calendar-nav-btn" id="nextMonth">‚Üí</button>
                        </div>
                        <button class="action-btn secondary" id="todayBtn">Today</button>
                    </div>
                    <div class="calendar-grid" id="calendarGrid">
                        <!-- Calendar will be generated here -->
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- DATE DETAIL PANEL -->
    <div class="date-panel" id="datePanel">
        <div class="date-panel-header">
            <span class="date-panel-title" id="datePanelTitle">Date Details</span>
            <button class="close-panel-btn" id="closePanelBtn">‚úï</button>
        </div>
        <div class="date-panel-content">
            <!-- Post Type -->
            <div class="panel-section">
                <div class="panel-section-title">Post Type</div>
                <div class="type-options" id="postTypeOptions">
                    <div class="type-option" data-value="post">
                        <div class="type-option-icon">üñºÔ∏è</div>
                        <div class="type-option-label">Post</div>
                    </div>
                    <div class="type-option" data-value="reel">
                        <div class="type-option-icon">üé¨</div>
                        <div class="type-option-label">Reel</div>
                    </div>
                    <div class="type-option" data-value="story">
                        <div class="type-option-icon">üì±</div>
                        <div class="type-option-label">Story</div>
                    </div>
                </div>
            </div>

            <!-- Status -->
            <div class="panel-section">
                <div class="panel-section-title">Status</div>
                <div class="status-options" id="statusOptions">
                    <div class="status-option" data-value="idea">üí° Idea</div>
                    <div class="status-option" data-value="designing">üé® Designing</div>
                    <div class="status-option" data-value="ready">‚úÖ Ready</div>
                    <div class="status-option" data-value="posted">üöÄ Posted</div>
                </div>
            </div>

            <!-- Images -->
            <div class="panel-section">
                <div class="panel-section-title">Images</div>
                <div class="image-upload-area" id="imageUploadArea">
                    <div class="image-upload-icon">üì∑</div>
                    <div class="image-upload-text">Click or drag images here</div>
                    <input type="file" id="imageInput" accept="image/*" multiple style="display: none;">
                </div>
                <div class="image-preview-grid" id="imagePreviewGrid"></div>
            </div>

            <!-- Notes -->
            <div class="panel-section">
                <div class="panel-section-title">Notes</div>
                <div class="rich-editor">
                    <div class="rich-editor-toolbar">
                        <button class="editor-btn" data-command="bold" title="Bold">B</button>
                        <button class="editor-btn" data-command="italic" title="Italic"><i>I</i></button>
                        <button class="editor-btn" data-command="underline" title="Underline"><u>U</u></button>
                        <button class="editor-btn" data-command="insertUnorderedList" title="Bullet List">‚Ä¢</button>
                        <button class="editor-btn" data-command="insertOrderedList" title="Numbered List">1.</button>
                    </div>
                    <div class="rich-editor-content" id="notesEditor" contenteditable="true" placeholder="Add notes..."></div>
                </div>
            </div>

            <!-- Caption -->
            <div class="panel-section">
                <div class="panel-section-title">Caption</div>
                <textarea class="form-textarea" id="captionInput" placeholder="Write your caption here..."></textarea>
            </div>

            <!-- Hashtags -->
            <div class="panel-section">
                <div class="panel-section-title">Hashtags</div>
                <textarea class="form-textarea" id="hashtagsInput" placeholder="#instagram #content #planning"></textarea>
            </div>
        </div>
    </div>

    <!-- MOBILE NAVIGATION -->
    <nav class="mobile-nav">
        <button class="mobile-nav-btn active" data-view="dashboard">
            <span class="mobile-nav-btn-icon">üè†</span>
            <span>Home</span>
        </button>
        <button class="mobile-nav-btn" data-view="pages">
            <span class="mobile-nav-btn-icon">üì±</span>
            <span>Pages</span>
        </button>
        <button class="mobile-nav-btn" id="mobileExportBtn">
            <span class="mobile-nav-btn-icon">üíæ</span>
            <span>Export</span>
        </button>
    </nav>

    <!-- TOAST CONTAINER -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- CONFIRMATION MODAL -->
    <div class="modal-overlay" id="confirmModal">
        <div class="modal">
            <h3 class="modal-title" id="modalTitle">Confirm Action</h3>
            <p class="modal-text" id="modalText">Are you sure you want to proceed?</p>
            <div class="modal-actions">
                <button class="action-btn secondary" id="modalCancelBtn">Cancel</button>
                <button class="action-btn danger" id="modalConfirmBtn">Confirm</button>
            </div>
        </div>
    </div>

    <script>
        /* ========================================
           INSTAGRAM PAGE CALENDAR MANAGER
           Local-only storage using IndexedDB & LocalStorage
        ======================================== */

        (function() {
            'use strict';

            // ========== STATE MANAGEMENT ==========
            const AppState = {
                currentPageId: null,
                currentDate: null,
                currentMonth: new Date().getMonth(),
                currentYear: new Date().getFullYear(),
                pages: [],
                calendarData: {}
            };

            // ========== INDEXEDDB WRAPPER ==========
            const ImageDB = {
                db: null,
                dbName: 'InstaCalendarImages',
                storeName: 'images',
                version: 1,

                // Initialize IndexedDB
                async init() {
                    return new Promise((resolve, reject) => {
                        const request = indexedDB.open(this.dbName, this.version);

                        request.onerror = () => {
                            console.error('IndexedDB error:', request.error);
                            reject(request.error);
                        };

                        request.onsuccess = () => {
                            this.db = request.result;
                            resolve(this.db);
                        };

                        request.onupgradeneeded = (event) => {
                            const db = event.target.result;
                            if (!db.objectStoreNames.contains(this.storeName)) {
                                db.createObjectStore(this.storeName, { keyPath: 'id' });
                            }
                        };
                    });
                },

                // Save image blob
                async saveImage(id, blob, pageId, date) {
                    return new Promise((resolve, reject) => {
                        const transaction = this.db.transaction([this.storeName], 'readwrite');
                        const store = transaction.objectStore(this.storeName);
                        const request = store.put({ id, blob, pageId, date, timestamp: Date.now() });

                        request.onsuccess = () => resolve(id);
                        request.onerror = () => reject(request.error);
                    });
                },

                // Get image by ID
                async getImage(id) {
                    return new Promise((resolve, reject) => {
                        const transaction = this.db.transaction([this.storeName], 'readonly');
                        const store = transaction.objectStore(this.storeName);
                        const request = store.get(id);

                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                },

                // Get all images for a specific page and date
                async getImagesForDate(pageId, date) {
                    return new Promise((resolve, reject) => {
                        const transaction = this.db.transaction([this.storeName], 'readonly');
                        const store = transaction.objectStore(this.storeName);
                        const request = store.getAll();

                        request.onsuccess = () => {
                            const images = request.result.filter(
                                img => img.pageId === pageId && img.date === date
                            );
                            resolve(images);
                        };
                        request.onerror = () => reject(request.error);
                    });
                },

                // Get all images
                async getAllImages() {
                    return new Promise((resolve, reject) => {
                        const transaction = this.db.transaction([this.storeName], 'readonly');
                        const store = transaction.objectStore(this.storeName);
                        const request = store.getAll();

                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                },

                // Delete image by ID
                async deleteImage(id) {
                    return new Promise((resolve, reject) => {
                        const transaction = this.db.transaction([this.storeName], 'readwrite');
                        const store = transaction.objectStore(this.storeName);
                        const request = store.delete(id);

                        request.onsuccess = () => resolve();
                        request.onerror = () => reject(request.error);
                    });
                },

                // Delete all images for a page
                async deleteImagesForPage(pageId) {
                    const images = await this.getAllImages();
                    const pageImages = images.filter(img => img.pageId === pageId);
                    for (const img of pageImages) {
                        await this.deleteImage(img.id);
                    }
                },

                // Convert blob to base64
                async blobToBase64(blob) {
                    return new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.onloadend = () => resolve(reader.result);
                        reader.onerror = reject;
                        reader.readAsDataURL(blob);
                    });
                }
            };

            // ========== LOCAL STORAGE WRAPPER ==========
            const Storage = {
                PAGES_KEY: 'insta_calendar_pages',
                DATA_KEY: 'insta_calendar_data',

                // Save pages list
                savePages(pages) {
                    try {
                        localStorage.setItem(this.PAGES_KEY, JSON.stringify(pages));
                    } catch (e) {
                        console.error('Storage error:', e);
                        UI.showToast('Storage error. Data may not be saved.', 'error');
                    }
                },

                // Load pages list
                loadPages() {
                    try {
                        const data = localStorage.getItem(this.PAGES_KEY);
                        return data ? JSON.parse(data) : [];
                    } catch (e) {
                        console.error('Storage error:', e);
                        return [];
                    }
                },

                // Save calendar data
                saveCalendarData(data) {
                    try {
                        localStorage.setItem(this.DATA_KEY, JSON.stringify(data));
                    } catch (e) {
                        console.error('Storage error:', e);
                        UI.showToast('Storage error. Data may not be saved.', 'error');
                    }
                },

                // Load calendar data
                loadCalendarData() {
                    try {
                        const data = localStorage.getItem(this.DATA_KEY);
                        return data ? JSON.parse(data) : {};
                    } catch (e) {
                        console.error('Storage error:', e);
                        return {};
                    }
                }
            };

            // ========== UI UTILITIES ==========
            const UI = {
                // Show toast notification
                showToast(message, type = 'success') {
                    const container = document.getElementById('toastContainer');
                    const toast = document.createElement('div');
                    toast.className = `toast ${type}`;
                    toast.innerHTML = `<span>${type === 'success' ? '‚úì' : type === 'error' ? '‚úï' : '‚ö†'}</span> ${message}`;
                    container.appendChild(toast);

                    setTimeout(() => {
                        toast.style.animation = 'slideOut 0.3s ease forwards';
                        setTimeout(() => toast.remove(), 300);
                    }, 3000);
                },

                // Show confirmation modal
                showConfirm(title, text) {
                    return new Promise((resolve) => {
                        const modal = document.getElementById('confirmModal');
                        document.getElementById('modalTitle').textContent = title;
                        document.getElementById('modalText').textContent = text;
                        modal.classList.add('open');

                        const confirmBtn = document.getElementById('modalConfirmBtn');
                        const cancelBtn = document.getElementById('modalCancelBtn');

                        const cleanup = () => {
                            modal.classList.remove('open');
                            confirmBtn.removeEventListener('click', onConfirm);
                            cancelBtn.removeEventListener('click', onCancel);
                        };

                        const onConfirm = () => { cleanup(); resolve(true); };
                        const onCancel = () => { cleanup(); resolve(false); };

                        confirmBtn.addEventListener('click', onConfirm);
                        cancelBtn.addEventListener('click', onCancel);
                    });
                },

                // Format date for display
                formatDate(dateStr) {
                    const date = new Date(dateStr);
                    return date.toLocaleDateString('en-US', {
                        weekday: 'long',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                },

                // Generate unique ID
                generateId() {
                    return Date.now().toString(36) + Math.random().toString(36).substr(2);
                }
            };

            // ========== PAGES MANAGEMENT ==========
            const Pages = {
                // Create new page
                create(name = 'New Page') {
                    const page = {
                        id: UI.generateId(),
                        name: name,
                        notes: '',
                        createdAt: Date.now()
                    };
                    AppState.pages.push(page);
                    Storage.savePages(AppState.pages);
                    return page;
                },

                // Update page
                update(id, data) {
                    const index = AppState.pages.findIndex(p => p.id === id);
                    if (index !== -1) {
                        AppState.pages[index] = { ...AppState.pages[index], ...data };
                        Storage.savePages(AppState.pages);
                    }
                },

                // Delete page
                async delete(id) {
                    const confirmed = await UI.showConfirm(
                        'Delete Page',
                        'Are you sure you want to delete this page? All associated data will be lost.'
                    );

                    if (confirmed) {
                        // Delete all images for this page
                        await ImageDB.deleteImagesForPage(id);

                        // Delete calendar data for this page
                        delete AppState.calendarData[id];
                        Storage.saveCalendarData(AppState.calendarData);

                        // Delete page from list
                        AppState.pages = AppState.pages.filter(p => p.id !== id);
                        Storage.savePages(AppState.pages);

                        AppState.currentPageId = null;
                        App.render();
                        UI.showToast('Page deleted successfully');
                    }
                },

                // Get page by ID
                get(id) {
                    return AppState.pages.find(p => p.id === id);
                },

                // Count planned posts for a page
                countPosts(pageId) {
                    const pageData = AppState.calendarData[pageId];
                    if (!pageData) return 0;
                    return Object.keys(pageData).length;
                }
            };

            // ========== CALENDAR MANAGEMENT ==========
            const Calendar = {
                months: ['January', 'February', 'March', 'April', 'May', 'June',
                         'July', 'August', 'September', 'October', 'November', 'December'],
                days: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],

                // Render calendar grid
                render() {
                    const grid = document.getElementById('calendarGrid');
                    grid.innerHTML = '';

                    // Day headers
                    this.days.forEach(day => {
                        const header = document.createElement('div');
                        header.className = 'calendar-day-header';
                        header.textContent = day;
                        grid.appendChild(header);
                    });

                    // Get first day and days in month
                    const firstDay = new Date(AppState.currentYear, AppState.currentMonth, 1).getDay();
                    const daysInMonth = new Date(AppState.currentYear, AppState.currentMonth + 1, 0).getDate();
                    const daysInPrevMonth = new Date(AppState.currentYear, AppState.currentMonth, 0).getDate();

                    // Previous month days
                    for (let i = firstDay - 1; i >= 0; i--) {
                        const dayEl = this.createDayElement(daysInPrevMonth - i, true);
                        grid.appendChild(dayEl);
                    }

                    // Current month days
                    const today = new Date();
                    for (let day = 1; day <= daysInMonth; day++) {
                        const dateStr = this.getDateString(AppState.currentYear, AppState.currentMonth, day);
                        const isToday = today.getDate() === day &&
                                       today.getMonth() === AppState.currentMonth &&
                                       today.getFullYear() === AppState.currentYear;
                        const hasContent = this.hasContent(dateStr);
                        
                        const dayEl = this.createDayElement(day, false, isToday, hasContent, dateStr);
                        grid.appendChild(dayEl);
                    }

                    // Next month days
                    const totalCells = firstDay + daysInMonth;
                    const remainingCells = totalCells % 7 === 0 ? 0 : 7 - (totalCells % 7);
                    for (let i = 1; i <= remainingCells; i++) {
                        const dayEl = this.createDayElement(i, true);
                        grid.appendChild(dayEl);
                    }

                    // Update header
                    document.getElementById('currentMonthYear').textContent =
                        `${this.months[AppState.currentMonth]} ${AppState.currentYear}`;
                },

                // Create day element
                createDayElement(day, isOtherMonth, isToday = false, hasContent = false, dateStr = null) {
                    const el = document.createElement('div');
                    el.className = 'calendar-day';
                    if (isOtherMonth) el.classList.add('other-month');
                    if (isToday) el.classList.add('today');
                    if (hasContent) el.classList.add('has-content');

                    el.innerHTML = `<span class="calendar-day-number">${day}</span>`;

                    if (!isOtherMonth && dateStr) {
                        el.addEventListener('click', () => DatePanel.open(dateStr));
                    }

                    return el;
                },

                // Get date string in YYYY-MM-DD format
                getDateString(year, month, day) {
                    return `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                },

                // Check if date has content
                hasContent(dateStr) {
                    const pageData = AppState.calendarData[AppState.currentPageId];
                    return pageData && pageData[dateStr];
                },

                // Navigate months
                prevMonth() {
                    AppState.currentMonth--;
                    if (AppState.currentMonth < 0) {
                        AppState.currentMonth = 11;
                        AppState.currentYear--;
                    }
                    this.render();
                },

                nextMonth() {
                    AppState.currentMonth++;
                    if (AppState.currentMonth > 11) {
                        AppState.currentMonth = 0;
                        AppState.currentYear++;
                    }
                    this.render();
                },

                goToToday() {
                    const today = new Date();
                    AppState.currentMonth = today.getMonth();
                    AppState.currentYear = today.getFullYear();
                    this.render();
                }
            };

            // ========== DATE PANEL MANAGEMENT ==========
            const DatePanel = {
                // Open panel for specific date
                async open(dateStr) {
                    AppState.currentDate = dateStr;
                    document.getElementById('datePanelTitle').textContent = UI.formatDate(dateStr);
                    document.getElementById('datePanel').classList.add('open');

                    // Load existing data
                    const pageData = AppState.calendarData[AppState.currentPageId] || {};
                    const dateData = pageData[dateStr] || {};

                    // Set values
                    this.setPostType(dateData.postType || null);
                    this.setStatus(dateData.status || null);
                    document.getElementById('notesEditor').innerHTML = dateData.notes || '';
                    document.getElementById('captionInput').value = dateData.caption || '';
                    document.getElementById('hashtagsInput').value = dateData.hashtags || '';

                    // Load images
                    await this.loadImages();
                },

                // Close panel
                close() {
                    document.getElementById('datePanel').classList.remove('open');
                    AppState.currentDate = null;
                },

                // Set post type
                setPostType(value) {
                    document.querySelectorAll('#postTypeOptions .type-option').forEach(el => {
                        el.classList.toggle('selected', el.dataset.value === value);
                    });
                },

                // Set status
                setStatus(value) {
                    document.querySelectorAll('#statusOptions .status-option').forEach(el => {
                        el.classList.toggle('selected', el.dataset.value === value);
                    });
                },

                // Get current data from panel
                getData() {
                    const postType = document.querySelector('#postTypeOptions .type-option.selected');
                    const status = document.querySelector('#statusOptions .status-option.selected');

                    return {
                        postType: postType ? postType.dataset.value : null,
                        status: status ? status.dataset.value : null,
                        notes: document.getElementById('notesEditor').innerHTML,
                        caption: document.getElementById('captionInput').value,
                        hashtags: document.getElementById('hashtagsInput').value
                    };
                },

                // Save current data
                save() {
                    if (!AppState.currentPageId || !AppState.currentDate) return;

                    const data = this.getData();
                    
                    // Check if data is empty
                    const isEmpty = !data.postType && !data.status && 
                                   !data.notes.trim() && !data.caption.trim() && 
                                   !data.hashtags.trim();

                    if (!AppState.calendarData[AppState.currentPageId]) {
                        AppState.calendarData[AppState.currentPageId] = {};
                    }

                    if (isEmpty) {
                        delete AppState.calendarData[AppState.currentPageId][AppState.currentDate];
                    } else {
                        AppState.calendarData[AppState.currentPageId][AppState.currentDate] = data;
                    }

                    Storage.saveCalendarData(AppState.calendarData);
                    Calendar.render();
                },

                // Load images for current date
                async loadImages() {
                    const grid = document.getElementById('imagePreviewGrid');
                    grid.innerHTML = '';

                    try {
                        const images = await ImageDB.getImagesForDate(AppState.currentPageId, AppState.currentDate);
                        
                        for (const img of images) {
                            const item = document.createElement('div');
                            item.className = 'image-preview-item';
                            
                            const imgEl = document.createElement('img');
                            imgEl.src = URL.createObjectURL(img.blob);
                            
                            const deleteBtn = document.createElement('button');
                            deleteBtn.className = 'image-delete-btn';
                            deleteBtn.textContent = '√ó';
                            deleteBtn.onclick = async () => {
                                const confirmed = await UI.showConfirm('Delete Image', 'Are you sure you want to delete this image?');
                                if (confirmed) {
                                    await ImageDB.deleteImage(img.id);
                                    await this.loadImages();
                                    App.updateStats();
                                    UI.showToast('Image deleted');
                                }
                            };

                            item.appendChild(imgEl);
                            item.appendChild(deleteBtn);
                            grid.appendChild(item);
                        }
                    } catch (e) {
                        console.error('Error loading images:', e);
                    }
                },

                // Upload images
                async uploadImages(files) {
                    for (const file of files) {
                        if (!file.type.startsWith('image/')) continue;

                        const id = UI.generateId();
                        try {
                            await ImageDB.saveImage(id, file, AppState.currentPageId, AppState.currentDate);
                        } catch (e) {
                            console.error('Error saving image:', e);
                            UI.showToast('Error saving image', 'error');
                        }
                    }

                    await this.loadImages();
                    this.ensureDateHasData();
                    App.updateStats();
                    UI.showToast('Images uploaded successfully');
                },

                // Ensure date entry exists when images are added
                ensureDateHasData() {
                    if (!AppState.calendarData[AppState.currentPageId]) {
                        AppState.calendarData[AppState.currentPageId] = {};
                    }
                    if (!AppState.calendarData[AppState.currentPageId][AppState.currentDate]) {
                        AppState.calendarData[AppState.currentPageId][AppState.currentDate] = this.getData();
                        Storage.saveCalendarData(AppState.calendarData);
                        Calendar.render();
                    }
                }
            };

            // ========== EXPORT FUNCTIONALITY ==========
            const Export = {
                // Export all data
                async exportAll() {
                    try {
                        UI.showToast('Preparing export...', 'warning');

                        const images = await ImageDB.getAllImages();
                        const imagesWithBase64 = [];

                        for (const img of images) {
                            const base64 = await ImageDB.blobToBase64(img.blob);
                            imagesWithBase64.push({
                                id: img.id,
                                pageId: img.pageId,
                                date: img.date,
                                timestamp: img.timestamp,
                                data: base64
                            });
                        }

                        const exportData = {
                            version: '1.0',
                            exportedAt: new Date().toISOString(),
                            pages: AppState.pages,
                            calendarData: AppState.calendarData,
                            images: imagesWithBase64
                        };

                        this.downloadJSON(exportData, 'insta-calendar-backup');
                        UI.showToast('Export completed successfully!');
                    } catch (e) {
                        console.error('Export error:', e);
                        UI.showToast('Export failed. Please try again.', 'error');
                    }
                },

                // Export single page
                async exportPage(pageId) {
                    try {
                        UI.showToast('Preparing export...', 'warning');

                        const page = Pages.get(pageId);
                        if (!page) {
                            UI.showToast('Page not found', 'error');
                            return;
                        }

                        const allImages = await ImageDB.getAllImages();
                        const pageImages = allImages.filter(img => img.pageId === pageId);
                        const imagesWithBase64 = [];

                        for (const img of pageImages) {
                            const base64 = await ImageDB.blobToBase64(img.blob);
                            imagesWithBase64.push({
                                id: img.id,
                                pageId: img.pageId,
                                date: img.date,
                                timestamp: img.timestamp,
                                data: base64
                            });
                        }

                        const exportData = {
                            version: '1.0',
                            exportedAt: new Date().toISOString(),
                            page: page,
                            calendarData: AppState.calendarData[pageId] || {},
                            images: imagesWithBase64
                        };

                        this.downloadJSON(exportData, `insta-calendar-${page.name.toLowerCase().replace(/\s+/g, '-')}`);
                        UI.showToast('Page export completed!');
                    } catch (e) {
                        console.error('Export error:', e);
                        UI.showToast('Export failed. Please try again.', 'error');
                    }
                },

                // Download JSON file
                downloadJSON(data, prefix) {
                    const date = new Date().toISOString().split('T')[0];
                    const filename = `${prefix}-${date}.json`;
                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }
            };

            // ========== MAIN APP ==========
            const App = {
                // Initialize app
                async init() {
                    try {
                        // Initialize IndexedDB
                        await ImageDB.init();

                        // Load data from localStorage
                        AppState.pages = Storage.loadPages();
                        AppState.calendarData = Storage.loadCalendarData();

                        // Setup event listeners
                        this.setupEventListeners();

                        // Initial render
                        this.render();
                        this.updateStats();

                        console.log('Instagram Calendar Manager initialized');
                    } catch (e) {
                        console.error('Initialization error:', e);
                        UI.showToast('Error initializing app. Please refresh.', 'error');
                    }
                },

                // Setup all event listeners
                setupEventListeners() {
                    // Navigation
                    document.getElementById('navDashboard').addEventListener('click', () => this.showDashboard());
                    document.getElementById('backToDashboard').addEventListener('click', () => this.showDashboard());

                    // Add page
                    document.getElementById('addPageBtn').addEventListener('click', () => {
                        const page = Pages.create();
                        AppState.currentPageId = page.id;
                        this.showWorkspace();
                        UI.showToast('New page created!');
                    });

                    // Global export
                    document.getElementById('globalExportBtn').addEventListener('click', () => Export.exportAll());
                    document.getElementById('mobileExportBtn').addEventListener('click', () => Export.exportAll());

                    // Workspace buttons
                    document.getElementById('openCalendarBtn').addEventListener('click', () => {
                        document.getElementById('calendarContainer').classList.toggle('hidden');
                        Calendar.render();
                    });

                    document.getElementById('exportPageBtn').addEventListener('click', () => {
                        if (AppState.currentPageId) {
                            Export.exportPage(AppState.currentPageId);
                        }
                    });

                    document.getElementById('deletePageBtn').addEventListener('click', () => {
                        if (AppState.currentPageId) {
                            Pages.delete(AppState.currentPageId);
                        }
                    });

                    // Page name/notes auto-save
                    document.getElementById('pageNameInput').addEventListener('input', (e) => {
                        if (AppState.currentPageId) {
                            Pages.update(AppState.currentPageId, { name: e.target.value });
                            this.renderPagesList();
                        }
                    });

                    document.getElementById('pageNotesInput').addEventListener('input', (e) => {
                        if (AppState.currentPageId) {
                            Pages.update(AppState.currentPageId, { notes: e.target.value });
                        }
                    });

                    // Calendar navigation
                    document.getElementById('prevMonth').addEventListener('click', () => Calendar.prevMonth());
                    document.getElementById('nextMonth').addEventListener('click', () => Calendar.nextMonth());
                    document.getElementById('todayBtn').addEventListener('click', () => Calendar.goToToday());

                    // Date panel close
                    document.getElementById('closePanelBtn').addEventListener('click', () => DatePanel.close());

                    // Post type selection
                    document.querySelectorAll('#postTypeOptions .type-option').forEach(el => {
                        el.addEventListener('click', () => {
                            DatePanel.setPostType(el.dataset.value);
                            DatePanel.save();
                        });
                    });

                    // Status selection
                    document.querySelectorAll('#statusOptions .status-option').forEach(el => {
                        el.addEventListener('click', () => {
                            DatePanel.setStatus(el.dataset.value);
                            DatePanel.save();
                        });
                    });

                    // Rich text editor buttons
                    document.querySelectorAll('.editor-btn').forEach(btn => {
                        btn.addEventListener('click', () => {
                            document.execCommand(btn.dataset.command, false, null);
                            DatePanel.save();
                        });
                    });

                    // Auto-save text fields
                    document.getElementById('notesEditor').addEventListener('input', () => DatePanel.save());
                    document.getElementById('captionInput').addEventListener('input', () => DatePanel.save());
                    document.getElementById('hashtagsInput').addEventListener('input', () => DatePanel.save());

                    // Image upload
                    const uploadArea = document.getElementById('imageUploadArea');
                    const imageInput = document.getElementById('imageInput');

                    uploadArea.addEventListener('click', () => imageInput.click());
                    
                    uploadArea.addEventListener('dragover', (e) => {
                        e.preventDefault();
                        uploadArea.style.borderColor = 'var(--primary)';
                        uploadArea.style.background = 'rgba(225,48,108,0.1)';
                    });

                    uploadArea.addEventListener('dragleave', () => {
                        uploadArea.style.borderColor = '';
                        uploadArea.style.background = '';
                    });

                    uploadArea.addEventListener('drop', (e) => {
                        e.preventDefault();
                        uploadArea.style.borderColor = '';
                        uploadArea.style.background = '';
                        if (e.dataTransfer.files.length) {
                            DatePanel.uploadImages(e.dataTransfer.files);
                        }
                    });

                    imageInput.addEventListener('change', (e) => {
                        if (e.target.files.length) {
                            DatePanel.uploadImages(e.target.files);
                        }
                    });

                    // Mobile menu
                    document.getElementById('menuToggle').addEventListener('click', () => {
                        document.getElementById('sidebar').classList.toggle('open');
                        document.getElementById('sidebarOverlay').classList.toggle('open');
                    });

                    document.getElementById('sidebarOverlay').addEventListener('click', () => {
                        document.getElementById('sidebar').classList.remove('open');
                        document.getElementById('sidebarOverlay').classList.remove('open');
                    });

                    // Mobile navigation
                    document.querySelectorAll('.mobile-nav-btn[data-view]').forEach(btn => {
                        btn.addEventListener('click', () => {
                            if (btn.dataset.view === 'dashboard') {
                                this.showDashboard();
                            } else if (btn.dataset.view === 'pages') {
                                document.getElementById('sidebar').classList.add('open');
                                document.getElementById('sidebarOverlay').classList.add('open');
                            }
                        });
                    });
                },

                // Render app
                render() {
                    this.renderPagesList();
                    this.renderPagesGrid();
                    
                    if (AppState.currentPageId) {
                        this.showWorkspace();
                    } else {
                        this.showDashboard();
                    }
                },

                // Render pages list in sidebar
                renderPagesList() {
                    const container = document.getElementById('pagesList');
                    const title = container.querySelector('.nav-title');
                    container.innerHTML = '';
                    container.appendChild(title);

                    if (AppState.pages.length === 0) {
                        const empty = document.createElement('p');
                        empty.style.cssText = 'font-size: 13px; color: var(--text-light); padding: 10px;';
                        empty.textContent = 'No pages yet. Create one!';
                        container.appendChild(empty);
                        return;
                    }

                    AppState.pages.forEach(page => {
                        const item = document.createElement('div');
                        item.className = 'page-item';
                        if (page.id === AppState.currentPageId) {
                            item.classList.add('active');
                        }
                        
                        item.innerHTML = `
                            <div class="page-item-name">${page.name || 'Unnamed Page'}</div>
                            <div class="page-item-meta">üìù ${Pages.countPosts(page.id)} posts planned</div>
                        `;

                        item.addEventListener('click', () => {
                            AppState.currentPageId = page.id;
                            this.showWorkspace();
                            // Close mobile sidebar
                            document.getElementById('sidebar').classList.remove('open');
                            document.getElementById('sidebarOverlay').classList.remove('open');
                        });

                        container.appendChild(item);
                    });
                },

                // Render pages grid in dashboard
                renderPagesGrid() {
                    const container = document.getElementById('pagesGrid');
                    
                    if (AppState.pages.length === 0) {
                        container.innerHTML = `
                            <div class="welcome-message">
                                <div class="welcome-icon">üì±</div>
                                <h2>Welcome to InstaCalendar!</h2>
                                <p>Create your first Instagram page to get started.</p>
                            </div>
                        `;
                        return;
                    }

                    container.innerHTML = '';
                    AppState.pages.forEach(page => {
                        const card = document.createElement('div');
                        card.className = 'card';
                        card.style.cursor = 'pointer';
                        card.innerHTML = `
                            <h3 style="font-size: 18px; margin-bottom: 8px;">${page.name || 'Unnamed Page'}</h3>
                            <p style="color: var(--text-light); font-size: 14px; margin-bottom: 12px;">
                                ${page.notes ? page.notes.substring(0, 100) + '...' : 'No notes'}
                            </p>
                            <div style="display: flex; gap: 15px; font-size: 13px; color: var(--text-light);">
                                <span>üìù ${Pages.countPosts(page.id)} posts</span>
                            </div>
                        `;

                        card.addEventListener('click', () => {
                            AppState.currentPageId = page.id;
                            this.showWorkspace();
                        });

                        container.appendChild(card);
                    });
                },

                // Show dashboard
                showDashboard() {
                    AppState.currentPageId = null;
                    document.getElementById('dashboardView').classList.remove('hidden');
                    document.getElementById('workspaceView').classList.add('hidden');
                    document.getElementById('calendarContainer').classList.add('hidden');
                    DatePanel.close();

                    this.renderPagesList();
                    this.renderPagesGrid();
                    this.updateStats();

                    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                    document.getElementById('navDashboard').classList.add('active');
                },

                // Show workspace for current page
                showWorkspace() {
                    const page = Pages.get(AppState.currentPageId);
                    if (!page) {
                        this.showDashboard();
                        return;
                    }

                    document.getElementById('dashboardView').classList.add('hidden');
                    document.getElementById('workspaceView').classList.remove('hidden');

                    document.getElementById('pageNameInput').value = page.name || '';
                    document.getElementById('pageNotesInput').value = page.notes || '';

                    this.renderPagesList();

                    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                },

                // Update dashboard stats
                async updateStats() {
                    document.getElementById('totalPages').textContent = AppState.pages.length;

                    let totalPosts = 0;
                    for (const pageId in AppState.calendarData) {
                        totalPosts += Object.keys(AppState.calendarData[pageId]).length;
                    }
                    document.getElementById('totalPosts').textContent = totalPosts;

                    try {
                        const images = await ImageDB.getAllImages();
                        document.getElementById('totalImages').textContent = images.length;
                    } catch (e) {
                        document.getElementById('totalImages').textContent = '0';
                    }
                }
            };

            // Initialize app when DOM is ready
            document.addEventListener('DOMContentLoaded', () => App.init());
        })();
    </script>
</body>
</html>
